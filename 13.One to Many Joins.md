# One to Many Joins

So far, we have covered data whcih is basically within one table at a time.the data has been kind of self contained and no data has been related.But of course, in the real world, all of our data or almost all of it, is related.

For example, we don't have books on a website without also having things like reviews, customers and shopping carts.

Or we might have cars in our database, but then we might have salesmen and dealerships and all of the other things that go along with it.

---

Now we will start to work with multiple tables that are connected.

So we're going to talk about how data is related and then how to implement those relations using multiple tables and some of the buzzwords, some of the big things 
we're talking about here are joints, foreign keys and primary keys, one to one, one to many, many to many relationships etc.

---

<!-- L 219 - Data is Messy --> 

# Data is Messy

this is a section all about relationships and also something called joints, which we'll get to in the second part of this section.

Real world data, unlike what we've been working with, is really messy typically and interrelated. There's a lot of connections between data.

---

So we're going to focus on how we work with interconnected data in the next couple of sections. So we're no longer focusing on one table. We're going to see how do we work with two tables or three or four that are related.

So not just tables that exist independently, but tables that reference one another and are interconnected.

---

![image](https://user-images.githubusercontent.com/107522496/211056789-c0ac1e72-6f6e-46fd-96eb-fe41661dd22d.png)

If we think back to our books table, if we had a bookshop in real life, we would need to do things such as keep track of versions for each book. For example, UK verison and US verison, hardback and paperback, coloured or black and white version. 

How do you keep track of that? Is that a different table or do you just make a separate book for every one of those? But if you do that, then how do you make sure that they're connected?

![image](https://user-images.githubusercontent.com/107522496/211059127-3f55ae38-5d58-4743-9d03-73eccd223a3a.png)

---

Then we have authors. Well, that might seem straightforward. We have an author, first name and last name, two columns on our books table, but that's not sufficient when we have multiple authors. Some books have multiple authors. What about if it's a research paper that we're selling or a journal that has dozens of authors potentially? So there's a lot of things to keep track of there that we can't really do right now. We only have room for one author in our columns.

---


Then a whole big thing is customers.If we're doing a shop online, books on their own is great, but we also need ways to keep track of customers. So, customers on their own also can't do that much, but we might keep track of their email log in information. Of course, we wouldn't just store their password directly, but for simplicity's sake, let's say we're keeping track of password and email so that they can log in.

---

Orders.

So if customers want to order books, how do we store that? We need to create a new order and it needs to be associated with a customer who created it. It needs to have address information. Maybe it needs to have the contents of the order. Are there books? One book? How do we support that? How do we handle that? What about if we're working with dates and times and we need to keep track of when a return period expires? So we need to have a an order date and then keep track of 30 days or 60 days after that or whatever it is. Then we also need to store or somehow keep track of the transaction information addresses for billing address, not only shipping address, the type of shipping, the billing information. There's so much to store.


---

And then a whole other thing is reviews. So if we go on Amazon or pretty much any book site, any book that you look at will have dozens or hundreds, sometimes thousands of reviews. So we've got reviews, their ratings, that's the number of stars. But then also a title for the review and then a caption and then the actual content of the review, which may be ten characters. I hate this book, however many characters that is. Or it could be a giant paragraph, someone's love letter that they're writing to a book. So how do we account for all of that?

---

And then the last thing that we'll talk about are genres. We could just have one genre. But many books don't cleanly fit into one genre. We might have a vampire novel that's also historical fiction because it's set in Victorian period. England Or we might have a sci fi book that has elements of fantasy or who knows, you can have all sorts of cross-pollinated genres, so only assigning one genre might not be that useful. We may want to have a bunch more. And in fact, on Amazon you can see there are books that will have two or three different genres or different tags associated with them.

---

So what I'm trying to show you here is that we were working with books on their own, but in a typical app or a typical website that has to do with books and a bookstore, in our case, there's a lot more that goes along with books to make anything functional, to store any important information. And this is, I don't know, maybe half of the tables that you would need to get away with kind of the the MVP or the bare minimum.

---

Something like orders, for instance, might actually need to be split into a couple of tables. We might need to have an address section or an address table. We might need to then have a separate billing table. We might need to have shipping. There could be all different tables that we could split it up into.

---

<!-- L220. Relationships Basics -->

# Relationships Basics

Moving on, how do we try to understand how we represent complex data using MySQL?  The answer is we're going to start by talking about the relationship basics.

This is about the different ways that data can be related. For example, if we have two tables, such as orders and customers, students and courses, or movies and reviews, how are these two tables related.

---

There's three main types of relationships:

* One to One Relationship 
* One to Many Relationship
* Many to Many Relationship

---

One to One Relationships are not that common. 

For example, we have two tables. One contains the main details for a customer, such as name, address and email address and the second contains morein-depth details on each customer, such as age, gender, hobbies, dislikes etc. customer_one has their own row, one row in the customer details table and one row in the customer in_depth table. Each row is associated with one customer. This means there's no other customer that could be associated with the customer_one's row because it's a 1 to 1 relationship.

However, One to One Relationship is not that common.

---

Most common is actually a One to Many Relationships. 

![image](https://user-images.githubusercontent.com/107522496/211340197-ae697ae5-a9d0-4e4a-afc1-8c077bc7d4ae.png)

Here's an example, the relationship between books and reviews. One book can have thousands of reviews. But each review in the Reviews table belong to only one specfic book. 

So the relationship is books have many reviews, but reviews belong to one book. So it's a one to many relationship.

This means the Reviews to Books relationship is One and the Books to Reviews relationship is Many. 

---

![image](https://user-images.githubusercontent.com/107522496/211344496-63babec8-79b7-4bff-aad5-7c0a0836a697.png)

Many to Many Relationships are still fairly common. The way this works is, we have, for example, tow entities, Books and Authors. The way we say it is that a book can have many authors, for example, two authors could write a book together. And those authors can have many books.

So, this is an example of a Many to Many Relationship.

---

# One to Many Relationship

We will be mainly covering One to Many as this is the most common and essential type.

---

![image](https://user-images.githubusercontent.com/107522496/211348640-b8d0a176-321c-4747-a3ad-7b6895cac21c.png)

Let's start with a classic example, Customers and Orders tables. This will be a One to Many Relationship. For example, we have a customer called Joe Harris. Joe can make many orders as he likes, but each order in the table will only belong to one customer. There is no way to have two people associated with one order.

So, it's a one to many. Customers have many orders, but orders have one customer associated with them.

---

![image](https://user-images.githubusercontent.com/107522496/211349549-d54a2806-727e-4e6d-8d92-ca030bda44aa.png)

In our example of Customers and Orders tables, let's look at the basic types of data we might want to store. For Customers table, we would need first and last name, customer's eemail. 

In a more complex table, we could store registartion date, last login date, phone number etc. 

In the Orders table, we would have date of purchase and price of order. 

The first three would be VARCHAR, date would be DATA type, and price would be decimal.

---

The next question is how do we store that, in other words, how do we represent this?

![image](https://user-images.githubusercontent.com/107522496/211351522-5cd1301a-959a-420d-9311-09ed02f32a81.png)

Technically, we could use one table but it would cause issues. For example, there is a lot of duplicated data.

Another issuse is that David Bowie and Blue Steele have got customer details on them, but because they have not placed an order yet, there is no value in for ther `order_date` and `amount`.

---

So, it's much better to keep our data separated because if we ever need to work with just customers on their own, which happens, there are times on a site where you don't care about orders, you just care about customers.

So, doing it this way is a bad idea. So, what do we do?

---

![image](https://user-images.githubusercontent.com/107522496/211353760-94f9d4b2-ebca-4cd4-993c-94dcce0568e5.png)

Here is the simplest approach. This is how we express a one to many relationship.

We have two tables, Customers and Orders. Each has its own fields. But most importantly ...

![image](https://user-images.githubusercontent.com/107522496/211355660-290c16de-d291-439c-a3fa-749d5b4f54c0.png)

The Orders table has a customer_id (does not matter what it is called) which is a reference to the customer_id field in the Customers table. 

So, whatever customer_id is in a given order (order table), it is going to correspond to an actual customer (customer_id in the Customers table) who placed it.

Continue From 6:49

---

![image](https://user-images.githubusercontent.com/107522496/211512661-546f44ee-e840-4aa8-a750-6bb03a89e4e8.png)

Here is an example. We split up the data which was presented earlier, i.e., the above is the split up version of the tabel below: 

![image](https://user-images.githubusercontent.com/107522496/211512941-d476322e-0362-47e1-a87d-c605bdc65191.png)

---

In the split up version, in the Customers table we have a customer_id column and in the Orders table we have a customer_id column. The customer_id column in the Orders table tells us which customer has placed the order by pointing towards the Customers table's customer_id column.

As David Bowie and Blue Steele have not bought anything, we don't have data for them in the Orders table. This means there is no extra or NULL data for them. So, we are not storing anythin we don't need.

---

So this is the classic way of structuring a one to many relationship. There are two main terms that need to be discussed.

---

# Primary Key 

![image](https://user-images.githubusercontent.com/107522496/211514200-0836ffb6-65f0-4ad1-85b0-ea6ee12c7277.png)

What a primary key means is that some particular column, in our case the customer_id column, is always unique. This means we only have one row which has a customer_id of 1, 2, 3, etc. 

This is important because if we reference it in another table, as in our case the Orders table, if there are two different customers that have ID of one, then it is useless because which one does it refer to? So it has to be unique.

That's why we can use Auto Increment as it will make sure whenever a new row is being inserted, that it is unqiue. This ensures no two rows have the same ID.

Then we have the column order_id in the Orders table which is also a primary key which means that each order is unique. 

 ---

# Foreign Key

![image](https://user-images.githubusercontent.com/107522496/211522634-1bcde6de-49f0-4d83-ad9d-d4eedec5f9e8.png)

Foreign Keys are references to another table from within another given table. In our example, the customer_id in the Orders table is referencing the customer_id in the Customers table. 

This means the Customers table does not have a foreign key as it is not referring to another table, but the orders has a primary and foreign key.

We will discuss how to define a foreign key in the schema later on as this is important. For example,  if we try to reference a row which does not exist in another table, we would want it to let us know so we can fix it.

For example, if we tried to insert an customer_id of 20 in the Orders table but there is no customer_id of 20 in the Customers table, we would want it to cause an error and make us aware. This is why we would define the foreign key in the schema.

Otherwise, if we don't say that it's a foreign key explicitly, we could have customer IDs all over the place that don't actually exist.

---

<!-- L 222 - Working with FOREIGN KEY -->

# Working with FOREIGN KEY

![image](https://user-images.githubusercontent.com/107522496/211524843-9c6e5106-30ec-40d7-b6d7-42d3b6992251.png)

Now, try and define these tables. Let's start with customers.

We have customer_id which will be a primary key, auto increment and it will be an integer.

![image](https://user-images.githubusercontent.com/107522496/211526018-8468d5b3-0c4f-49b7-a0fa-602e3de35a1c.png)

---

And now let's create the Orders table: 

![image](https://user-images.githubusercontent.com/107522496/211530704-66117a2c-29d0-4636-a1c8-6c4c970e376a.png)

When setting up the customer_id column in the Orders table, we need to make it clear that this column is associated with the customer's table. 

`INT`: we have used the same data type as id is in the customers table.  

---

This is what it will look like all put together. 

![image](https://user-images.githubusercontent.com/107522496/211531073-d046285d-78e8-423a-a047-4a2663ec4998.png)


```sql
CREATE DATABASE shop;

CREATE TABLE customers (
id INT PRIMARY KEY AUTO_INCREMENT,
first_name VARCHAR (50),
last_name VARCHAR (50),
email VARCHAR (50)
);

CREATE TABLE orders (
id INT PRIMARY KEY AUTO_INCREMENT,
order_date DATE,
amount DECIMAL (8,2),
customer_id INT,
);

INSERT INTO customers (first_name,last_name,email)
VALUES ('Boy', 'George','george@gmail.com'),
	   ('David', 'Bowie','david@gmail.com'),
	   ('George', 'Michael','gm@gmail.com'),
	   ('Blue', 'Steel','blue@gmail.com'),
	   ('Bette', 'Davis','bette@aol.com');

INSERT INTO orders (order_date,amount,customer_id)
VALUES ('2016-02-10', 99.99, 1),
	   ('2017-11-11', 35.50, 1),
	   ('2014-12-12', 800.67, 2),
	   ('2015-01-03', 12.50, 2),
	   ('1999-04-11', 450.25, 5);

```

---

![image](https://user-images.githubusercontent.com/107522496/211531374-bf7d5939-4574-4ebd-958a-e154e0ab1d62.png)

When we run `SELECT * FROM orders;` this is what we get. The customer_id is meant to be referencing an actual customer_id in the Customers table. However, if we insert a row into orders which does not refer back to an customer_id in the Customers table, at the moment, it still will run. For example, 

![image](https://user-images.githubusercontent.com/107522496/211532129-5282d1dd-a5c5-459e-bad3-fd044711c267.png)

Here, we have entered a row with the customer_id equal to 525 in the Orders table, however, there is no customer_id of 525 in the Customers table. 

We don't want this to happen. 

We want to enforce a rule that if we have a foreign key in the orders table called customer_id that is supposed to be linked to a real customer in the customer's table, why don't we set up a rule or a constraint that says that the foreign key (customer_id in the Orders table), has to be a real ID in the Customers table.

---

The way we do this is by using the Foreign Key constraint. 

Now, when we set up a foreign key constraint, it doesn't have to be unique, but it does have to reference a real ID in the other table.

---

![image](https://user-images.githubusercontent.com/107522496/211533506-6fe1fbb7-1d02-4ada-bc16-a882af56de04.png)

This is how we do it. `FOREIGN KEY (customer_id) REFERENCES customers(id)`. The first customer_id is referring to the customer_id within the same table, in this case, the orders table. 

`REFERENCES customers(id)`: is referring to the id column in the customers tbale. 

---

![image](https://user-images.githubusercontent.com/107522496/211533867-ec2a3d86-ab14-465e-9557-eaee1ca712fd.png)

Essentially, this is what we have done. We have linked both of these columns together to ensure that we can enter a number for customer_id in the orders tablww which does not exist in the Customers table.  

---

![image](https://user-images.githubusercontent.com/107522496/211537463-c902c760-5023-48fc-b3f0-806f9763ec0c.png)

```sql
CREATE TABLE customers (
id INT PRIMARY KEY AUTO_INCREMENT,
first_name VARCHAR (50),
last_name VARCHAR (50),
email VARCHAR (50)
);

CREATE TABLE orders (
id INT PRIMARY KEY AUTO_INCREMENT,
order_date DATE,
amount DECIMAL (8,2),
customer_id INT,
FOREIGN KEY (customer_id) REFERENCES customers(id)
);

INSERT INTO customers (first_name,last_name,email)
VALUES ('Boy', 'George','george@gmail.com'),
	   ('David', 'Bowie','david@gmail.com'),
	   ('George', 'Michael','gm@gmail.com'),
	   ('Blue', 'Steel','blue@gmail.com'),
	   ('Bette', 'Davis','bette@aol.com');

INSERT INTO orders (order_date,amount,customer_id)
VALUES ('2016-02-10', 99.99, 1),
	   ('2017-11-11', 35.50, 1),
	   ('2014-12-12', 800.67, 2),
	   ('2015-01-03', 12.50, 2),
	   ('1999-04-11', 450.25, 5);

```

---

![image](https://user-images.githubusercontent.com/107522496/211537701-c5fb4038-9569-4e4b-9e1b-5ba3cfda81fa.png)

This is what we currently have in the orders table. 

Let's try and add a customer_id in the orders table which does not exist in the customers table ...

![image](https://user-images.githubusercontent.com/107522496/211537977-6119d371-001d-4554-b097-e6b7604e8a29.png)

Now we see an error occurs as it says a foreign key constraint fails which means the customer-id we have tried to enter is not a real customer_id.

---

![image](https://user-images.githubusercontent.com/107522496/211539139-d21ca93c-3fe0-487e-b904-358e3d536e1b.png)

Now, because the customer_id of 3 does exist, David Bowie, it allows us to inout this data into the orders table. 

![image](https://user-images.githubusercontent.com/107522496/211539683-3c18dce2-a9e2-4eec-a28a-9cad6b9e7c5b.png)

---

Now that we have a relationship setup, this One to Many Relationship where every customer can have many orders, but each order belongs to one customer, How do we do some basic operations and how do we combine the two? Or, for example, how write a query which tells us who ordered what order_id or how much each customer has spent?

How do we work with these separate tables and join them together? This is what we will cover next.

---


















