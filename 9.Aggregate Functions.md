# Aggregate Functions

<!-- L 129 - Section Introduction --> 

In this section, we are going to learn a lot about different ways of performing analysis on data. 

For example, finding averages, grouping data together, grouping by columns, 
calculating average quantities, find the average sales that we've had per year, 
we could do things like find the average page number for books per genre
 

If you're working with advertising data or let's say our Instagram data, which we will be using later on, 
do things like find out which one of our users is a power user or influencers, 
meaning that they have the most comments, the most likes on each one of their posts on average.

So who in our database is getting on average the most likes and comments?
Or we could do things like which hashtag generates the most traction.

---

<!-- L 130 - Count Basics --> 

# Count Basics 

We are going to learn about functions that can operate on multiple rows or multiple pieces 
of data at once to tell us the min or the max or the average or the sum or the count.

First, we will start with Count.

---

The Count function is a built-in function like `REPLACE`, `CONCAT`, `UPPER` etc. Can use it to count, in our example, how many books are in the database.

![image](https://user-images.githubusercontent.com/107522496/208420921-a3da5da0-c4ea-4c02-82c1-9504c87d78cc.png)

![image](https://user-images.githubusercontent.com/107522496/208421092-e8129be1-54b7-4943-b87d-79fe7c3238d5.png)

This means there are 19 rows in our database. 

`COUNT (*)` tells MySQL we want to count the rows that we get back from this query.

---

![image](https://user-images.githubusercontent.com/107522496/208421942-f2ef27a4-90cd-437a-85d8-14a7332c91fa.png)

When we try to combine other functions with `COUNT`, will get an error as whole point of `COUNT` is to output a single value.

---

## How many author_fname are there? 

![image](https://user-images.githubusercontent.com/107522496/208422258-54777d8e-07cf-4e73-af67-36f4277b3a4b.png)

To check How many author_fname are there, instead of using `SELECT COUNT (*)`, which counts all the rows, we can use `SELECT COUNT (author_fname)`, which will count all the first names or all the values in that column.  

![image](https://user-images.githubusercontent.com/107522496/208422572-c6eb6ea5-fa60-4dee-ae0d-c7c7459d2940.png)

We  still get 19. This is because it is counting everytime there is a value in the `author_fname` column.

---

To test this out, let's add two (empty )more rows into our books table:

![image](https://user-images.githubusercontent.com/107522496/208423090-0f326ac5-d8df-44aa-8308-f743615fd8f2.png)

---

Now when we count the rows, we will see that there are two more rows. So, in total, 21 rows.

![image](https://user-images.githubusercontent.com/107522496/208423353-1afde2a9-e606-48cd-a4dd-ad68d3d36c4f.png)

---

But if we count `author_fname`, we will see that there are 19 because two of those rows are empty and there is no `author_fname`, they have null in them.

![image](https://user-images.githubusercontent.com/107522496/208423444-6368a192-083d-4237-aa93-da0757d896d9.png)


---

### How many DISTINCT `author-fname` are there?

![image](https://user-images.githubusercontent.com/107522496/208423705-dac6f8b1-94e1-41a6-8b7c-3e01f8edc230.png)

What may be more useful is knowing how many unique `author_fname` there are in our table. The way that we do this is we actually pass `DISTINCT` into the parentheses.

![image](https://user-images.githubusercontent.com/107522496/208424183-8f182a2f-1234-4f85-8c7f-02f070ef9303.png)

These are the list of author first names.

---

![image](https://user-images.githubusercontent.com/107522496/208424014-27e32e5b-b30d-472c-99c4-df2eba62152c.png)

We can use `DISTINCT` to count each unique author first name once.

---

Next, let's see how we can check how many (amount of) titles contain "the"?

![image](https://user-images.githubusercontent.com/107522496/208427583-f199f054-6687-4152-b749-0bb2d0049483.png)

These are the titles which contain "the". But we want to count how many rows are there.


![image](https://user-images.githubusercontent.com/107522496/208427898-651bc489-2369-46b1-aff4-2dcb84e1bdf9.png)

```sql
SELECT COUNT(*) FROM books
WHERE title LIKE '%the%';
```

This means count the rows where title has the word "the" within it.

---

<!-- L 132 - GROUP BY --> 

# `GROUP BY`

This is one of the most useful and most important clauses in all of SQL, which is `GROUP BY`.

![image](https://user-images.githubusercontent.com/107522496/208436873-ca9d2a8f-0126-4d58-a6bd-ac706c89ae91.png)

So, what does the above definition mean? 

---

![image](https://user-images.githubusercontent.com/107522496/208436998-72692f3f-3393-4c5e-a636-18d9d5a62736.png)

`GROUP BY` is followed by a column name. In this case, it will group the rows from our books table based on the `author_lname`. Once they have been grouped, we can ask, how many books has each author written. For example, we had the below table:

![image](https://user-images.githubusercontent.com/107522496/208437377-19a38eef-b137-4201-9750-8a0b0cbfddf0.png)

The below is what would happen behind the scenes (and is not what would be displayed). We can then use this information to ask(using `COUNT`), for example, how many books has Lahiri written.

---

![image](https://user-images.githubusercontent.com/107522496/208438058-42b269dd-ac4f-4c33-a450-ee72273af3e6.png)

![image](https://user-images.githubusercontent.com/107522496/208438343-55fb6676-8d54-4ab9-84cd-1db37d8ce8d2.png)


```sql
SELECT author_lname, COUNT(*) 
FROM books GROUP BY author_lname;
```

This shows us how many books has each author written. It does this by counting the rows of each different group, not all the rows in the whole table,
but the rows in each group.

---

![image](https://user-images.githubusercontent.com/107522496/208439141-08a01fe2-c9c4-4df5-b326-b549d97e0a61.png)

This means there will e two rows for Lahiri, two rows for Gaiman and 1 row for Eggers etc. 

We would end up with something like this.

---

![image](https://user-images.githubusercontent.com/107522496/208443164-407fc58c-beac-4fde-8cdc-69436bb89b2a.png)

In our example, we can then also use `ORDER BY` to put them into order.

```sql
SELECT author_lname, COUNT(*) AS books_written
FROM books GROUP BY author_lname
ORDER BY books_written DESC;
```

---

# Another Example - Grouping by `released_year`.

Another example, let's try grouping by `released_year`.

![image](https://user-images.githubusercontent.com/107522496/208443936-d12e0b5c-246e-4469-b7b6-a522263d3ea1.png)

---

![image](https://user-images.githubusercontent.com/107522496/208445118-f93f910f-4e67-4a06-bd39-fc8542a1b55d.png)

Now, if we do `SELECT released_year FROM books GROUP BY released_year;` it will display the distinct years. So, we need to also use `COUNT(*)` to see how many rows there are for each group. 

---

![image](https://user-images.githubusercontent.com/107522496/208446119-39273ac7-5e4a-433e-9317-53d68a738ad2.png)

Can add `ORDER BY COUNT(*) DESC;` to order the data according to the rows for each group too. 

---

Or can sort it using an Alias. such as:

![image](https://user-images.githubusercontent.com/107522496/208446476-f9aef4ff-1aaf-47db-aefe-64d188a28543.png)

---

Generally the formula is, we will `GROUP BY` some column, and then we might use that column in our `SELECT`,
but then we almost always are going to have some aggregate function going on like `COUNT`, `MIN`, `MAX`, `AVERAGE` and `SUM`.

---































































